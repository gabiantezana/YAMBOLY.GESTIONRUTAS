@{
    ViewBag.Title = "Home Page";
}
<div>
    <input type="button" id="enablePolygon" value="Crear" />
    <input type="button" id="resetPolygon" value="Eliminar" style="display: none;" />
    <div id="showonPolygon" style="display:none;"><b>Area:</b> <span id="areaPolygon">&nbsp;</span></div>
    <div id="map" style="width: 500px; height: 400px;"></div>
</div>

@section Scripts{
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB0hFla3KhpSUtpkjK7gqJVqfqUCI-7oFs&sensor=false&libraries=drawing"></script>

    <script>

        initialize();

        var map;
        var all_overlays = [];
        var drawingManager;
        var selectedShape;

        function initialize() {
            map = new google.maps.Map(
                document.getElementById("map"), {
                    center: new google.maps.LatLng(37.4419, -122.1419),
                    zoom: 13,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });

            drawingManager = new google.maps.drawing.DrawingManager({
                drawingMode: google.maps.drawing.OverlayType.POLYGON,
                drawingControl: false,
                markerOptions: {
                    draggable: true
                },
                polygonOptions: {
                    strokeWeight: 0,
                    fillOpacity: 0.45,
                    editable: true,
                    fillColor: '#FF1493'
                }
            });

            $('#enablePolygon').click(function () {
                drawingManager.setMap(map);
                drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON);
            });

            $('#resetPolygon').click(function () {
                if (selectedShape) {
                    selectedShape.setMap(null);
                }
                drawingManager.setMap(null);
                $('#showonPolygon').hide();
                //$('#resetPolygon').hide();
            });

            $('#resetPolygon').show();
            google.maps.event.addListener(drawingManager, 'polygoncomplete', function (polygon) {
                //  var area = google.maps.geometry.spherical.computeArea(selectedShape.getPath());
                //  $('#areaPolygon').html(area.toFixed(2)+' Sq meters');
            });

            function clearSelection() {
                if (selectedShape) {
                    selectedShape.setEditable(false);
                    selectedShape = null;
                }
            }

            function setSelection(shape) {
                clearSelection();
                selectedShape = shape;
                shape.setEditable(true);
            }

            google.maps.event.addListener(drawingManager, 'overlaycomplete', function (e) {
                all_overlays.push(e);
                if (e.type != google.maps.drawing.OverlayType.MARKER) {

                    // Switch back to non-drawing mode after drawing a shape.
                    alert("Finish");
                    drawingManager.setDrawingMode(null);

                    // Add an event listener that selects the newly-drawn shape when the user
                    // mouses down on it.
                    var newShape = e.overlay;
                    newShape.type = e.type;
                    google.maps.event.addListener(newShape, 'click', function () {
                        setSelection(newShape);
                    });
                    setSelection(newShape);
                }
            });
        }

        //google.maps.event.addDomListener(window, "load", initialize);
    </script>
}
